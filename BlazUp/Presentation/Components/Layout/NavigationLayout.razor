@inherits LayoutComponentBase

@using Domain.Common.Enums

@inject IDialogService DialogService
@inject UserContext UserContext
@inject NavigationManager Nav

<!--NAVIGATION LAYOUT-->
<MudLayout>

    <!--NAVIGATION LAYOUT - APPBAR -->
    <MudAppBar Color="Color.Primary">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" @onclick="DrawerClicked" Class="text-color-main" />

        <MudStack Spacing="1" Class="ml-5">
            <MudText Typo="Typo.h6">Welcome, @UserContext.UserName!</MudText>
            <MudText Typo="Typo.body2">@_date</MudText>
        </MudStack>

        <MudSpacer />

        <MudImage Src="images/blazUpSymbol.jpg" Class="img-icon" />
        <MudText Typo="Typo.h6" Class="ml-2" Style="text-decoration: underline;">BlazUp</MudText>
    </MudAppBar>

    <!--NAVIGATION LAYOUT - DRAWER -->
    <MudDrawer @bind-Open="_menuOpen" Color="Color.Primary">
        <MudDrawerHeader>
            <MudStack Row="true" AlignItems="AlignItems.Center">
                <MudIcon Icon="@Icons.Material.Filled.MenuBook" />
                <MudText Typo="Typo.h4">Menu</MudText>
            </MudStack>
        </MudDrawerHeader>

        <!--NAVIGATION LAYOUT - DRAWER - LINKS -->
        <MudNavMenu Color="Color.Transparent">
            <MudNavLink Href="@AppRoutes.Home" Icon="@Icons.Material.Outlined.Home" IconColor="Color.Surface">
                Home
            </MudNavLink>
            <MudNavLink Href="@AppRoutes.Projects" Icon="@Icons.Material.Filled.Workspaces" IconColor="Color.Surface">
                Projects
            </MudNavLink>
            
            <!-- Load specific pages according to User Role -->
            @switch (UserContext.Role) {
                case Role.Admin:
                    foreach (var item in adminPages) {
                        <MudNavLink Href="@item.Href" Icon="@item.Icon" IconColor="Color.Surface">@item.tag</MudNavLink>
                    }
                    break;
                case Role.Developer:
                    foreach (var item in devPages) {
                        <MudNavLink Href="@item.Href" Icon="@item.Icon" IconColor="Color.Surface">@item.tag</MudNavLink>
                    }
                    break;
                case Role.Client: //Client does not have specific pages
                default:
                    break;
            }

            <MudNavLink Href="@AppRoutes.Notifications" Icon="@Icons.Material.Outlined.Notifications" IconColor="Color.Surface">
                Notifications
            </MudNavLink>
            <MudNavLink Href="@AppRoutes.Configuration" Icon="@Icons.Material.Filled.ManageAccounts" IconColor="Color.Surface">
                Configuration
            </MudNavLink>
            <MudNavLink @onclick="LogOutClick" Icon="@Icons.Material.Outlined.Logout" IconColor="Color.Surface">
                LogOut
            </MudNavLink>
        </MudNavMenu>
    </MudDrawer>

    <!--NAVIGATION LAYOUT - CONTENT -->
    <MudMainContent Class="container-main">
        @Body
    </MudMainContent>
</MudLayout>

@code {
    //-------------------------AUX.FIELDS-------------------------
    //Record para links de paginas especificas de cierto tipo de usuarios
    private record LinkPage(string Href, string tag, string Icon);
    
    private List<LinkPage> adminPages = new() { 
        new LinkPage(AppRoutes.AdminHistory, "History", Icons.Material.Filled.History),
        new LinkPage(AppRoutes.AdminRequests, "Requests", Icons.Material.Filled.Pending)
    };
    
    private List<LinkPage> devPages = new() { 
        new LinkPage(AppRoutes.DeveloperRequirements, "Requirements", Icons.Material.Filled.SpaceDashboard),
        new LinkPage(AppRoutes.DeveloperTasks, "Tasks", Icons.Material.Filled.Assignment)
    };

    private string _date = DateTime.Today.ToString("dddd, MMMM dd, yyyy");
    private bool _menuOpen = false;

    //-------------------------METHODS-------------------------
    private void DrawerClicked() => _menuOpen = !_menuOpen;

    private async Task LogOutClick() {
        var dialog = await DialogService.ShowAsync<LogOutDialog>();
        var result = await dialog.Result;

        if (result.Canceled) {
            _menuOpen = false;
            return;
        }

        UserContext.Clear();
        Nav.NavigateTo(AppRoutes.Login, true);
    }
}